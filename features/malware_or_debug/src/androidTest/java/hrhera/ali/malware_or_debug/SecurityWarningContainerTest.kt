package hrhera.ali.malware_or_debug

import androidx.activity.ComponentActivity
import androidx.compose.material3.MaterialTheme
import androidx.compose.ui.test.*
import androidx.compose.ui.test.junit4.createAndroidComposeRule
import org.junit.Rule
import org.junit.Test

class SecurityWarningContainerTest {

    @get:Rule
    val composeTestRule = createAndroidComposeRule<ComponentActivity>()

    @Test
    fun emulatorScreen_displaysEmulatorWarning() {
        val fakeViewModel = FakeSecurityWarningViewModel()

        composeTestRule.setContent {
            MaterialTheme {
                TestableSecurityWarningContainer(
                    isEmulator = true,
                    viewModel = fakeViewModel,
                    onNavigateNext = {}
                )
            }
        }

        composeTestRule.onNodeWithText("Emulator/Debug Mode Detected").assertIsDisplayed()
        composeTestRule.onNodeWithText("This application cannot run in emulator or on rooted/debug devices")
            .assertIsDisplayed()
        composeTestRule.onNodeWithText("Redirecting in").assertIsDisplayed()
        composeTestRule.onNodeWithText(fakeViewModel.secondsLeft.toString()).assertIsDisplayed()
        composeTestRule.onNodeWithContentDescription("Warning Icon").assertIsDisplayed()
    }

    @Test
    fun nonEmulatorScreen_displaysMalwareWarning() {
        val fakeViewModel = FakeSecurityWarningViewModel()
        composeTestRule.setContent {
            MaterialTheme {
                TestableSecurityWarningContainer(
                    isEmulator = false,
                    viewModel = fakeViewModel
                )
            }
        }
        composeTestRule.onNodeWithContentDescription("Warning Icon").assertIsDisplayed()
        composeTestRule.onNodeWithText("Security Threats Detected").assertIsDisplayed()
        composeTestRule.onNodeWithText("Your device contains potentially harmful applications").assertIsDisplayed()
    }
}
